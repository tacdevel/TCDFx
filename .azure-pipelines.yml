####################################################################################################
## FileName:             azure-pipelines.yml
## Copyright:            Copyright Â© 2017-2019 Thomas Corwin, et al. All Rights Reserved.
## License:              https://github.com/tom-corwin/tcdfx/blob/master/LICENSE.md
####################################################################################################

#TODO: Set up tests once finished.
#TODO: Set up documentation generation once finished.
#TODO: Have jobs for all (most) OS in this list using Docker maybe?: https://github.com/dotnet/core/blob/master/release-notes/3.0/3.0-supported-os.md
#TODO: Use a matrix to clean the jobs up a fair bit in-code.

## Global Configuration
################################################################################

name: $(Date:yyMMdd)$(Rev:rrr)

trigger:
  batch: false
  branches:
    include:
    - "master"
    - "feature/*"
    - "hotfix/*"
    - "ref/tags/v*"
  paths:
    exclude:
    - "*.md"
    - ".gitignore"
    - ".gitattributes"
    - ".editorconfig"
    - ".github/*"

pr:
  autoCancel: true
  branches:
    include:
    - master
    - feature/*
    - hotfix/*
    - ref/tags/v*
  paths:
    exclude:
    - "*.md"
    - ".gitignore"
    - ".gitattributes"
    - ".editorconfig"
    - ".github/*"

variables:
  TCDFxCITaggedBuild: $[ startsWith( variables['Build.SourceBranch'], 'ref/tags/v' )]
  DotNetCore.Sdk.Version: '3.0.100-preview7-012821'

jobs:

## Build Jobs
################################################################################
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'Ubuntu1604'
    osDisplayName: 'Ubuntu 16.04'
    vmImage: 'ubuntu-16.04'
    configuration: 'Debug'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'Ubuntu1604'
    osDisplayName: 'Ubuntu 16.04'
    vmImage: 'ubuntu-16.04'
    configuration: 'Release'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'macOS1013'
    osDisplayName: 'macOS 10.13'
    vmImage: 'macOS-10.13'
    configuration: 'Debug'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'macOS1013'
    osDisplayName: 'macOS 10.13'
    vmImage: 'macOS-10.13'
    configuration: 'Release'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'macOS1014'
    osDisplayName: 'macOS 10.14'
    vmImage: 'macOS-10.14'
    configuration: 'Debug'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'macOS1014'
    osDisplayName: 'macOS 10.14'
    vmImage: 'macOS-10.14'
    configuration: 'Release'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'Windows81'
    osDisplayName: 'Windows 8.1'
    vmImage: 'vs2015-win2012r2'
    configuration: 'Debug'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'Windows81'
    osDisplayName: 'Windows 8.1'
    vmImage: 'vs2015-win2012r2'
    configuration: 'Release'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'Windows10'
    osDisplayName: 'Windows 10'
    vmImage: 'windows-2019'
    configuration: 'Debug'
- template: ./.azure-pipelines/jobs/build.yml
  parameters:
    osName: 'Windows10'
    osDisplayName: 'Windows 10'
    vmImage: 'windows-2019'
    configuration: 'Release'

## Publish Jobs
################################################################################
- template: ./.azure-pipelines/jobs/publish.yml